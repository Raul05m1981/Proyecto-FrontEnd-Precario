<div class="grid justify-content-center">
  <div class="col-12 md:col-8 lg:col-6">
    <p-card>
      <ng-template pTemplate="title">Generador de documentos</ng-template>
      <ng-template pTemplate="subtitle">Ingrese el número de expediente</ng-template>

      <form [formGroup]="form" class="p-fluid" (ngSubmit)="procesar()">
        <div class="field mb-3">
          <label for="expedienteNumero" class="font-medium mb-1 block">Número de Expediente</label>
          <input id="expedienteNumero" pInputText formControlName="expedienteNumero"
                 placeholder="Ej: 01234-2025-0-1234-JR-CI-01" />
          <small class="p-error" *ngIf="f.expedienteNumero.touched && f.expedienteNumero.invalid">
            El número es obligatorio (mín. 8 caracteres)
          </small>
        </div>

        <div class="flex gap-2 mt-2">
          <button pButton type="submit" label="Procesar" icon="pi pi-cog" 
                  class="p-button-secondary" [disabled]="loading()"></button>
          <button pButton type="button" label="Cancelar" icon="pi pi-times"
                  class="p-button-secondary" (click)="cancelar()" [disabled]="loading()"></button>
          <span class="ml-auto"></span>
          <button pButton type="button" label="Ir a bandeja" icon="pi pi-folder-open"
                  class="p-button-secondary" (click)="irBandeja()"></button>
        </div>
      </form>

      <p-message *ngIf="errorMsg()" severity="danger" [text]="errorMsg() ?? ''"></p-message>
    </p-card>

    <p-card class="mt-3" *ngIf="result() as r">
      <ng-template pTemplate="title">Documentos generados</ng-template>
      <p-table [value]="r.items" responsiveLayout="scroll">
        <ng-template pTemplate="header">
          <tr>
            <th>Nombre</th>
            <th>Estado</th>
            <th class="text-right">Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-row>
          <tr>
            <td>{{ row.nombre }}</td>
            <td>{{ row.estado }}</td>
            <td class="text-right">
              <button pButton icon="pi pi-download" class="p-button-text"
                      (click)="descargar(row)" [disabled]="!row.url"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>

